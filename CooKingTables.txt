CREATE TABLE "user"(
	id INT GENERATED BY DEFAULT AS IDENTITY (START WITH 1 INCREMENT BY 1) PRIMARY KEY,
	login VARCHAR NOT NULL UNIQUE,
	password_hash VARCHAR NOT NULL
);

CREATE INDEX user_id ON "user" (id);

CREATE TABLE recipe(
	id INT GENERATED BY DEFAULT AS IDENTITY (START WITH 1 INCREMENT BY 1) PRIMARY KEY,
	author_id INT REFERENCES "user" ON DELETE CASCADE NOT NULL,
	title VARCHAR NOT NULL,
	description TEXT NOT NULL,
	time_minutes INT NOT NULL,
	likes INT DEFAULT 0,
	post_datetime TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP NOT NULL,
	photo_link VARCHAR NOT NULL
);

CREATE INDEX recipe_id ON recipe (id);

CREATE TABLE comment(
	id INT GENERATED BY DEFAULT AS IDENTITY (START WITH 1 INCREMENT BY 1) PRIMARY KEY,
	author_id INT REFERENCES "user" ON DELETE CASCADE NOT NULL,
	recipe_id INT REFERENCES recipe ON DELETE CASCADE NOT NULL,
	text TEXT NOT NULL,
	post_datetime TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP NOT NULL
);

CREATE INDEX comment_id ON comment (id);

CREATE TABLE ingredients(
	recipe_id INT REFERENCES recipe ON DELETE CASCADE NOT NULL,
	name VARCHAR NOT NULL,
	amount INT NOT NULL,
	unit_name VARCHAR NOT NULL
);

CREATE TABLE recipe_likes(
	user_id INT REFERENCES "user" ON DELETE CASCADE NOT NULL,
	recipe_id INT REFERENCES recipe ON DELETE CASCADE NOT NULL,
	like_datetime TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP NOT NULL
);

CREATE TABLE token(
	user_id INT REFERENCES "user" ON DELETE CASCADE NOT NULL,
	token VARCHAR NOT NULL UNIQUE,
	creation_datetime TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP NOT NULL
);
